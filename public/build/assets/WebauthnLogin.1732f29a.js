import{r as u,u as S,l as k,p as x,D as v,o as l,d as c,t as K,b as i,f as b,x as W,y as A,w as M,z as $,h as E}from"./app.053b6d29.js";import{_ as B}from"./InputError.5051588d.js";import{_ as C}from"./Button.b22e55ab.js";import D from"./WaitForKey.2f712a17.js";import{W as F}from"./webauthn.5f5be0a3.js";const N={key:0},T={key:1},I=E(" Retry "),O={__name:"WebauthnLogin",props:{publicKey:Object,remember:Boolean},setup(_){const r=_,p=u(!0),s=u(""),o=u(!1),a=S();k(()=>r.publicKey,t=>{s.value="",v().then(()=>f(t))}),x(()=>{s.value="",n.webAuthnSupport()||(p.value=!1,s.value=m()),r.publicKey&&f(r.publicKey)});const n=new F((t,e)=>{s.value=g(t,e)}),g=(t,e)=>{switch(t){case"InvalidStateError":return"Unexpected error on login.";case"NotAllowedError":return"The operation either timed out or was not allowed.";default:return e}},m=()=>{switch(n.notSupportedMessage()){case"not_supported":return"Your browser doesn\u2019t currently support WebAuthn.";case"not_secured":return"WebAuthn only supports secure connections. Please load this page with https scheme.";default:return""}},d=()=>{s.value="",$.Inertia.reload({only:["publicKey"]})},h=()=>{o.value=!1},f=t=>{o.value=!0,v().then(()=>n.sign(t,e=>{w(e)}))},w=t=>{a.transform(()=>({...t,remember:r.remember?"on":""})).post(route("webauthn.auth"),{preserveScroll:!0,preserveState:!0,onSuccess:()=>{h()},onError:e=>{s.value=e.message?e.message:e.data.errors[0],h()}})};return(t,e)=>(l(),c("div",null,[p.value?(l(),c("div",T,[i(D,{"error-message":s.value,form:b(a),onRetry:e[0]||(e[0]=y=>d())},null,8,["error-message","form"]),i(B,{message:b(a).errors.data,class:"mt-2"},null,8,["message"]),W(i(C,{class:"ml-2",onClick:e[1]||(e[1]=y=>d())},{default:M(()=>[I]),_:1},512),[[A,!o.value]])])):(l(),c("div",N,K(m()),1))]))}};export{O as default};
