/**
 * WebAuthn client.
 *
 * This file is part of asbiin/laravel-webauthn project.
 *
 * @copyright Alexis SAETTLER Â© 2019
 * @license MIT
 */function o(e=null){e&&this.setNotify(e)}o.prototype.register=function(e,t){let n=Object.assign({},e);n.user.id=this._bufferDecode(e.user.id),n.challenge=this._bufferDecode(this._base64Decode(e.challenge)),e.excludeCredentials&&(n.excludeCredentials=this._credentialDecode(e.excludeCredentials));var a=this;navigator.credentials.create({publicKey:n}).then(r=>{a._registerCallback(r,t)},r=>{a._notify(r.name,r.message,!1)})};o.prototype._registerCallback=function(e,t){let n={id:e.id,type:e.type,rawId:this._bufferEncode(e.rawId),response:{clientDataJSON:this._bufferEncode(e.response.clientDataJSON),attestationObject:this._bufferEncode(e.response.attestationObject)}};t(n)};o.prototype.sign=function(e,t){let n=Object.assign({},e);n.challenge=this._bufferDecode(this._base64Decode(e.challenge)),e.allowCredentials&&(n.allowCredentials=this._credentialDecode(e.allowCredentials));var a=this;navigator.credentials.get({publicKey:n}).then(r=>{a._signCallback(r,t)},r=>{a._notify(r.name,r.message,!1)})};o.prototype._signCallback=function(e,t){let n={id:e.id,type:e.type,rawId:this._bufferEncode(e.rawId),response:{authenticatorData:this._bufferEncode(e.response.authenticatorData),clientDataJSON:this._bufferEncode(e.response.clientDataJSON),signature:this._bufferEncode(e.response.signature),userHandle:e.response.userHandle?this._bufferEncode(e.response.userHandle):null}};t(n)};o.prototype._bufferEncode=function(e){return window.btoa(String.fromCharCode.apply(null,new Uint8Array(e)))};o.prototype._bufferDecode=function(e){var t=window.atob(e);return Uint8Array.from(t,n=>n.charCodeAt(0))};o.prototype._base64Decode=function(e){e=e.replace(/-/g,"+").replace(/_/g,"/");const t=e.length%4;if(t){if(t===1)throw new Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");e+=new Array(5-t).join("=")}return e};o.prototype._credentialDecode=function(e){var t=this;return e.map(function(n){return{id:t._bufferDecode(t._base64Decode(n.id)),type:n.type,transports:n.transports}})};o.prototype.webAuthnSupport=function(){return!(window.PublicKeyCredential===void 0||typeof window.PublicKeyCredential!="function"||typeof window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable!="function")};o.prototype.notSupportedMessage=function(){return!window.isSecureContext&&window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?"not_secured":"not_supported"};o.prototype._notify=function(e,t){this._notifyCallback&&this._notifyCallback(e,t)};o.prototype.setNotify=function(e){this._notifyCallback=e};export{o as W};
